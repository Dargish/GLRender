<?xml version='1.0' encoding='us-ascii'?>
<shader version="400">
  <include>DeferredCommon</include>
  <include>DynamicLighting</include>
  <include>Colorspace</include>
	<vertexshader>
		<input type="vec3" location="0">position</input>
    <uniform type="mat4">proj</uniform>
    <uniform type="mat4">view</uniform>
    <uniform type="vec3">eyePos</uniform>
    <output type="vec3">f_eyePos</output>
    <output type="vec3">f_worldPos</output>
		<source>
      f_eyePos = eyePos;
      f_worldPos = position;
      gl_Position = proj * view * vec4(position, 1.0);
    </source>
	</vertexshader>
	<fragmentshader>
    <input type="vec3">f_eyePos</input>
    <input type="vec3">f_worldPos</input>
    <uniform type="vec2">screenSize</uniform>
		<uniform type="vec3">direction</uniform>
		<uniform type="vec3">color</uniform>
		<uniform type="float">intensity</uniform>
		<output type="vec4">fragColor</output>
		<source>
      vec2 uv = gl_FragCoord.xy / screenSize;
      GBufferData data = ReadGBuffer(uv);

      vec3 eyeVec = normalize(f_worldPos - f_eyePos);

      vec3 V = normalize(-eyeVec);
      vec3 L = normalize(-direction);

      vec3 lighting = DynamicLighting(V, L, data);

      vec3 preGamma = lighting * intensity * color;
      vec3 postGamma = gammaCorrect(preGamma);
      fragColor = vec4(postGamma, 1);
    </source>
	</fragmentshader>
</shader>
